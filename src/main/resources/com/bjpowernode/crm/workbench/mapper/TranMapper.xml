<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bjpowernode.crm.workbench.mapper.TranMapper">
  <resultMap id="BaseResultMap" type="com.bjpowernode.crm.workbench.pojo.Tran">
    <id column="id" jdbcType="CHAR" property="id" />
    <result column="owner" jdbcType="CHAR" property="owner" />
    <result column="money" jdbcType="VARCHAR" property="money" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="expected_date" jdbcType="CHAR" property="expectedDate" />
    <result column="customer_id" jdbcType="CHAR" property="customerId" />
    <result column="stage" jdbcType="VARCHAR" property="stage" />
    <result column="type" jdbcType="VARCHAR" property="type" />
    <result column="source" jdbcType="VARCHAR" property="source" />
    <result column="activity_id" jdbcType="CHAR" property="activityId" />
    <result column="contacts_id" jdbcType="CHAR" property="contactsId" />
    <result column="create_by" jdbcType="VARCHAR" property="createBy" />
    <result column="create_time" jdbcType="CHAR" property="createTime" />
    <result column="edit_by" jdbcType="VARCHAR" property="editBy" />
    <result column="edit_time" jdbcType="CHAR" property="editTime" />
    <result column="description" jdbcType="VARCHAR" property="description" />
    <result column="contact_summary" jdbcType="VARCHAR" property="contactSummary" />
    <result column="next_contact_time" jdbcType="CHAR" property="nextContactTime" />
  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    delete from tbl_tran
    where id = #{id,jdbcType=CHAR}
  </delete>
  <insert id="insertTran" parameterType="com.bjpowernode.crm.workbench.pojo.Tran">
    insert into tbl_tran (id, owner, money, name, 
      expected_date, customer_id, stage, 
      type, source, activity_id, 
      contacts_id, create_by, create_time, 
      edit_by, edit_time, description, 
      contact_summary, next_contact_time)
    values (#{id,jdbcType=CHAR}, #{owner,jdbcType=CHAR}, #{money,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, 
      #{expectedDate,jdbcType=CHAR}, #{customerId,jdbcType=CHAR}, #{stage,jdbcType=VARCHAR}, 
      #{type,jdbcType=VARCHAR}, #{source,jdbcType=VARCHAR}, #{activityId,jdbcType=CHAR}, 
      #{contactsId,jdbcType=CHAR}, #{createBy,jdbcType=VARCHAR}, #{createTime,jdbcType=CHAR}, 
      #{editBy,jdbcType=VARCHAR}, #{editTime,jdbcType=CHAR}, #{description,jdbcType=VARCHAR}, 
      #{contactSummary,jdbcType=VARCHAR}, #{nextContactTime,jdbcType=CHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.bjpowernode.crm.workbench.pojo.Tran">
    update tbl_tran
    set owner = #{owner,jdbcType=CHAR},
      money = #{money,jdbcType=VARCHAR},
      name = #{name,jdbcType=VARCHAR},
      expected_date = #{expectedDate,jdbcType=CHAR},
      customer_id = #{customerId,jdbcType=CHAR},
      stage = #{stage,jdbcType=VARCHAR},
      type = #{type,jdbcType=VARCHAR},
      source = #{source,jdbcType=VARCHAR},
      activity_id = #{activityId,jdbcType=CHAR},
      contacts_id = #{contactsId,jdbcType=CHAR},
      create_by = #{createBy,jdbcType=VARCHAR},
      create_time = #{createTime,jdbcType=CHAR},
      edit_by = #{editBy,jdbcType=VARCHAR},
      edit_time = #{editTime,jdbcType=CHAR},
      description = #{description,jdbcType=VARCHAR},
      contact_summary = #{contactSummary,jdbcType=VARCHAR},
      next_contact_time = #{nextContactTime,jdbcType=CHAR}
    where id = #{id,jdbcType=CHAR}
  </update>
  <update id="updateTranStage">
    update tbl_tran
    set stage=#{stage},edit_by=#{editBy},edit_time=#{editTime}
    where id=#{id};
  </update>
  <select id="selectTranById" parameterType="java.lang.String" resultMap="BaseResultMap">
    select
      t.id,
      u.name owner,
      t.money,
      t.name,
      t.expected_date,
      c.name customer_id,
      t.stage,
      t.type,
      t.source,
      a.name activity_id,
      c2.fullname contacts_id,
      u1.name create_by,
      t.create_time,
      u2.name edit_by,
      t.edit_time,
      t.description,
      t.contact_summary,
      t.next_contact_time
    from tbl_tran t
    left join tbl_customer c
    on t.customer_id = c.id
    left join tbl_contacts c2
    on t.contacts_id = c2.id
    left join tbl_user u
    on t.owner = u.id
    left join tbl_user u1
    on t.create_by = u1.id
    left join tbl_user u2
    on t.edit_by = u2.id
    left join tbl_activity a
    on t.activity_id = a.id
    where t.id = #{id,jdbcType=CHAR}
  </select>
  <select id="selectTranForPage" resultMap="BaseResultMap">
    select
        t.id,
        u.name owner,
        t.money,
        t.name,
        t.expected_date,
        c.name customer_id,
        t.stage,
        t.type,
        t.source,
        t.activity_id,
        c2.fullname contacts_id,
        t.create_by,
        t.create_time,
        t.edit_by,
        t.edit_time,
        t.description,
        t.contact_summary,
        t.next_contact_time
    from tbl_tran t
    left join tbl_customer c
    on t.customer_id = c.id
    left join tbl_contacts c2
    on t.contacts_id = c2.id
    left join tbl_user u
    on t.owner = u.id
    order by t.create_time desc
    limit #{param1},#{param2}
  </select>
  <select id="selectTranCount" resultType="java.lang.Integer">
    select count(*)
    from tbl_tran
  </select>
    <select id="selectPerStageCount" resultType="com.bjpowernode.crm.workbench.pojo.TranStage">
      select stage name,count(*) value from tbl_tran group by stage
    </select>
</mapper>